datasource db {
    provider = "postgresql"
    url      = env("SESSION_URL")
}

generator client {
    provider = "go run github.com/steebchen/prisma-client-go"
}

model User {
    id              Int               @default(autoincrement())
    uuid            String            @id @unique @default(uuid())
    createdAt       DateTime          @default(now())
    updatedAt       DateTime          @updatedAt
    email           String            @unique
    password        String
    posts           Post[]
    comments        Comment[]
    likes           Like[]
    userProfile     UserProfile?
    PublicationPost PublicationPost[]
    UserFollower    UserFollower[]    @relation("UserFollower")
    UserFollowee    UserFollower[]    @relation("UserFollowee")
}

model UserProfile {
    id             Int      @default(autoincrement())
    uuid           String   @id @unique @default(uuid())
    firstName      String
    lastName       String
    bio            String
    profilePicture String
    user           User     @relation(fields: [userUuid], references: [uuid], onDelete: Cascade)
    userUuid       String   @unique
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt
}

model Post {
    id              Int              @default(autoincrement())
    uuid            String           @id @unique @default(uuid())
    title           String
    source          String
    srcType         SrcType
    createdAt       DateTime         @default(now())
    updatedAt       DateTime         @updatedAt
    published       Boolean
    userUuid        String
    user            User             @relation(fields: [userUuid], references: [uuid])
    tags            PostTag          @relation(onDelete: Cascade, fields: [postTagId], references: [id])
    category        PostCategory     @relation(fields: [postCategoryId], references: [id])
    postCategoryId  Int              @unique
    postTagId       Int              @unique
    comments        Comment[]
    likes           Like[]
    PublicationPost PublicationPost? @relation()
    publishPostUuid String?          @unique
    file            File?            @relation(fields: [fileId], references: [id])
    fileId          Int?             @unique
}

model PostTag {
    id        Int      @id @default(autoincrement())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    post      Post?    @relation()
    tags      String[]
}

model PostCategory {
    id        Int      @id @default(autoincrement())
    name      String   @unique
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    post      Post[]
}

enum SrcType {
    MARKDOWN_URL
    CONTENT
    MARKDOWN_FILE
}

model Comment {
    id        Int      @default(autoincrement())
    uuid      String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    content   String
    userUuid  String
    postUuid  String
    user      User     @relation(fields: [userUuid], references: [uuid])
    post      Post     @relation(fields: [postUuid], references: [uuid])
}

model Like {
    id        Int      @default(autoincrement())
    uuid      String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    userUuid  String
    postUuid  String
    user      User     @relation(fields: [userUuid], references: [uuid])
    post      Post     @relation(fields: [postUuid], references: [uuid])

    @@unique([userUuid, postUuid])
}

model UserFollower {
    id           Int      @id @default(autoincrement())
    createdAt    DateTime @default(now())
    updatedAt    DateTime @updatedAt
    follower     User     @relation(name: "UserFollower", fields: [followerUuid], references: [uuid])
    followee     User     @relation(name: "UserFollowee", fields: [followeeUuid], references: [uuid])
    followerUuid String
    followeeUuid String

    @@unique([followerUuid, followeeUuid])
}

model PublicationPost {
    id        Int      @default(autoincrement())
    uuid      String   @id @unique @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    User      User     @relation(fields: [userUuid], references: [uuid])
    Post      Post     @relation(onDelete: Cascade, fields: [postUuid], references: [uuid])
    postUuid  String   @unique
    userUuid  String
}

model File {
    id        Int      @id @default(autoincrement())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    fileName  String
    fileType  String
    fileUrl   String
    post      Post?
    postUuid  String?  @unique
}
